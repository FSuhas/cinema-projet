<script>
  if (window.location.pathname == '/candidatures') {
    document.querySelector("#body").style = 'height: calc(100vh); background: linear-gradient(to top, #ada996, #f2f2f2, #dbdbdb, #eaeaea);';
  }

  let scrollpos = window.scrollY
  const header = document.querySelector("#body")
  const header_height = header.offsetHeight

  const add_class_on_scroll = () => header.classList.add("fade-in")
  const remove_class_on_scroll = () => header.classList.remove("fade-in")

  window.addEventListener('scroll', function() {
    scrollpos = window.scrollY;

    if (scrollpos <= header_height) { add_class_on_scroll() }
    else { remove_class_on_scroll() }

  })
</script>

<%= render 'shared/navbar' %>


<div class="container" style="display: inline;">
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="future-tab" data-bs-toggle="tab" data-bs-target="#future" type="button" role="tab" aria-controls="future" aria-selected="true">
      Evenements à venir
    </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button" role="tab" aria-controls="past" aria-selected="false">
        Evenements passés
      </button>
    </li>
  </ul>
  <hr>
</div>
<div class="tab-content" id="myTabContent">
  <div class="tab-pane fade active show" id="future" role="tabpanel"  aria-labelledby="future-tab" >
    <div class="">
      <div class="container" style="display: flex;justify-content: center;align-items: center;">
        <div class="container" >
          <% @bookings.each do |b| %>
          <% if b.post.date >= Date.today %>
            <p>Pour le : <%= b.post.date.strftime("%d/%m/%y") %></p>
            <hr>
              <%= link_to post_path(b.post_id) do %>
                <div class="card-candidat" style="margin-bottom: 20px;">
                  <% if b.post.photos.attached? %>
                    <%= cl_image_tag b.post.photos[0].key, height: 150 , class: 'candidat-photo', crop: :fill %>
                  <% else %>
                    <%= image_tag "https://images.unsplash.com/random?", height: 150 , class: 'candidat-photo', crop: :fill %>
                  <% end %>
                  <div class="card-candidat-info">
                    <strong id="titre"><%= b.post.titre %></strong><br>
                      <% if b.confirmation === false %>
                        <div>
                          <span class="badge bg-warning">En attente</span>
                          <%= link_to booking_path(b), id: 'trash', data: { turbo_method: :delete, turbo_confirm: "Souhaitez-vous retirer vôtre candidature ?" } do %>
                          <i class="fa-solid fa-circle-xmark" style="font-size: 30px; color: rgb(252, 5, 5)"></i>
                          <% end %>
                        </div>
                        <% else b.confirmation === true %>
                        <span class="badge bg-success">Accepté</span>
                      <% end %>
                    </div>
                </div>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    <%= render 'shared/footer' %>
  </div>
</div>

<div class="tab-pane fade" id="past" role="tabpanel" aria-labelledby="past-tab">
  <div class="">
    <div class="container" style="display: flex;justify-content: center;align-items: center;">
      <div class="container" >
        <% @bookings.each do |b| %>
        <% if b.post.date <= Date.today %>
          <p>Pour le : <%= b.post.date.strftime("%d/%m/%y") %></p>
          <hr>
            <%= link_to post_path(b.post_id) do %>
              <div class="card-candidat" style="margin-bottom: 20px;">
                <% if b.post.photos.attached? %>
                  <%= cl_image_tag b.post.photos[0].key, height: 150 , class: 'candidat-photo', crop: :fill %>
                <% else %>
                  <%= image_tag "https://images.unsplash.com/random?", height: 150 , class: 'candidat-photo', crop: :fill %>
                <% end %>
                <div class="card-candidat-info">
                  <strong id="titre"><%= b.post.titre %></strong><br>
                    <% if b.confirmation === false %>
                      <div>
                        <span class="badge bg-warning">En attente</span>
                        <%= link_to booking_path(b), id: 'trash', data: { turbo_method: :delete, turbo_confirm: "Souhaitez-vous retirer vôtre candidature ?" } do %>
                        <i class="fa-solid fa-circle-xmark" style="font-size: 30px; color: rgb(252, 5, 5)"></i>
                        <% end %>
                      </div>
                      <% else b.confirmation === true %>
                      <span class="badge bg-success">Accepté</span>
                    <% end %>
                  </div>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
    <%= render 'shared/footer' %>
  </div>
</div>
